LOGS %WinDir%\System32\Pecmd.log

CALL OSInit
CALL PreShell
CALL Shortcuts
CALL InitPENetwork
CALL LoadShell
CALL FinalProcesses

TIPS  The Configuration is Finished.,,1,#1
EXIT



_SUB OSInit
  FIND $%USERNAME%=Administrator,REGI HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList\S-1-5-18\ProfileImagePath=X:\Users\Administrator

  // Load Display drivers (Uncommented if "Display drivers" selected). Not to be changed, Replace //EXEC by //=EXEC
  // EXEC =@!%WinDir%\System32\Drvload.exe %WinDir%\inf\basicdisplay.inf %WinDir%\inf\basicrender.inf %WinDir%\inf\c_display.inf %WinDir%\inf\display.inf %WinDir%\inf\displayoverride.inf

  TEAM DISP W1024 H768 B32|DISP W1366 H768 B32
  LOGO %WinDir%\web\wallpaper\Windows\HBCD_PE.jpg
  NUMK 1

  TEXT Initializing Hiren's BootCD PE stripped-lwbt... L59 T39 $20

  // Load Audio Drivers
  // DEVI %WinDir%\inf\hdaudio.inf

  // Load Network Drivers
  EXEC =@!%WinDir%\System32\Drvload.exe %WinDir%\inf\athw8x.inf %WinDir%\inf\netathr10x.inf %WinDir%\inf\netathrx.inf %WinDir%\inf\netbc63a.inf %WinDir%\inf\netbc64.inf %WinDir%\inf\netrtwlane.inf %WinDir%\inf\netrtwlane_13.inf %WinDir%\inf\netrtwlanu.inf %WinDir%\inf\netwbw02.inf %WinDir%\inf\netwew00.inf %WinDir%\inf\netwew01.inf %WinDir%\inf\netwlan92de.inf %WinDir%\inf\netwlv64.inf %WinDir%\inf\netwns64.inf %WinDir%\inf\netwsw00.inf %WinDir%\inf\netwtw02.inf %WinDir%\inf\netwtw04.inf %WinDir%\inf\netwtw06.inf
_END



_SUB PreShell
  EXEC @!%WinDir%\System32\winpeshl.exe
  EXEC =@!%WinDir%\System32\LetterSwap.exe /auto /SetLetter Y:\HBCD_PE.ini /Log %Temp%\LetterSwap.log
  EXEC @!%WinDir%\System32\FixScreen.exe

  // Load and install oem* drivers in background before shell
  EXEC @!%WinDir%\System32\pnputil.exe /add-driver %WinDir%\inf\oem*.inf /install

  // Load Users Drivers from Y before shell in background (Uncommented By User Option)
  EXEC @!%WinDir%\System32\pnputil.exe /add-driver Y:\CustomDrivers\*.inf /subdirs /install
  EXEC @!%WinDir%\System32\pnputil.exe /add-driver X:\CustomDrivers\*.inf /subdirs /install

  // Load external Autorun.cmd or PecmdStartup.ini to run program, Install external drivers, keyboard,...
  IFEX Y:\XPEStartup.ini,LOAD Y:\XPEStartup.ini
  IFEX Y:\XPEStartup.cmd,EXEC @!Y:\XPEStartup.cmd

  // Install ImDisk Ramdisk in background (Uncommented if "Imdisk ramdisk" selected). Not to be changed, Replace //EXEC by //=EXEC
  // EXEC =@!%WinDir%\System32\StartImDIsk.exe 50 % B: RAMDisk "NTFS Compressed" "B:\Temp"
  // IFEX Y:\,IFEX Y:\Programs\,EXEC =@%WinDir%\System32\Cmd.exe /C Mklink /D B:\Programs Y:\Programs
  
  INIT IU,3000
_END



_SUB Shortcuts
  // WinXShell
  LINK %Programs%\System Tools\WinXShell\Calendar,%ProgramFiles%\WinXShell\WinXShell.exe,-ui -jcfg wxsUI\UI_Calendar.zip\calendar.jcfg,%ProgramFiles%\WinXShell\wxsUI\Calendar.ico
  LINK %Programs%\System Tools\WinXShell\Display Settings,%ProgramFiles%\WinXShell\WinXShell.exe,-ui -jcfg wxsUI\UI_Resolution.zip,%ProgramFiles%\WinXShell\wxsUI\display.ico
  LINK %Programs%\System Tools\WinXShell\Settings,%ProgramFiles%\WinXShell\WinXShell.exe,-ui -jcfg wxsUI\UI_Settings.zip,%ProgramFiles%\WinXShell\wxsUI\settings.ico
  LINK %Programs%\System Tools\WinXShell\Shutdown,%ProgramFiles%\WinXShell\WinXShell.exe,-ui -jcfg wxsUI\UI_Shutdown.zip\full.jcfg,%ProgramFiles%\WinXShell\wxsUI\Power.ico
  LINK %Programs%\System Tools\WinXShell\SystemInfo,%ProgramFiles%\WinXShell\WinXShell.exe,-ui -jcfg wxsUI\UI_SystemInfo.zip,%ProgramFiles%\WinXShell\wxsUI\MyPC.ico
  LINK %Programs%\System Tools\WinXShell\Volume,%ProgramFiles%\WinXShell\WinXShell.exe,-ui -jcfg wxsUI\UI_Volume.zip\main.jcfg,%ProgramFiles%\WinXShell\wxsUI\Volume.ico
  LINK %Programs%\System Tools\WinXShell\Wifi,%ProgramFiles%\WinXShell\WinXShell.exe,-ui -jcfg wxsUI\UI_WIFI.zip\main.jcfg -theme dark,%ProgramFiles%\WinXShell\wxsUI\wifi.ico
  // WinXShell.exe -ui -jcfg wxsUI\UI_Launcher.zip -theme dark

  // Accessories
  LINK %Programs%\Accessories\Calculator,%WinDir%\System32\calc.exe
  LINK %Programs%\Accessories\Explorer,%WinDir%\explorer.exe
  LINK %Programs%\Accessories\Notepad,%WinDir%\System32\notepad.exe
  LINK %Programs%\Accessories\Paint,%WinDir%\System32\mspaint.exe
  LINK %Programs%\Accessories\Snipping Tool,%WinDir%\System32\SnippingTool.exe

  // Administrative Tools
  LINK %Programs%\Administrative Tools\Computer Management,%WinDir%\System32\compmgmt.msc
  LINK %Programs%\Administrative Tools\Control Panel,%WinDir%\System32\control.exe
  LINK %Programs%\Administrative Tools\Device Manager,%WinDir%\System32\devmgmt.msc
  LINK %Programs%\Administrative Tools\Disk Management,%WinDir%\System32\diskmgmt.msc
  LINK %Programs%\Administrative Tools\Services,%WinDir%\System32\services.msc

  // Hard Disk Tools - Data Recovery
  LINK %Programs%\Hard Disk Tools\Check Disk GUI,Y:\Programs\Check Disk GUI\chkdsk.exe
  LINK %Programs%\Hard Disk Tools\PhotoRec,X:\Program Files\Testdisk\qphotorec_win.exe
  LINK %Programs%\Hard Disk Tools\Runtime DriveImage XML,Y:\Programs\Runtime DriveImage XML\dixml.exe
  LINK %Programs%\Hard Disk Tools\Test Disk,X:\Program Files\Testdisk\testdisk_win.exe
  // BCD-MBR Tools
  LINK %Programs%\Hard Disk Tools\BootIce,Y:\Programs\Bootice\BOOTICEx64.exe
  LINK %Programs%\Hard Disk Tools\EasyBCD,Y:\Programs\EasyBCD\EasyBCD.exe

  // Security - Passwords & Keys
  LINK %Programs%\Passwords & Keys\ProduKey,Y:\Programs\ProduKey\ProduKey.exe
  LINK %Programs%\Passwords & Keys\ShowKeyPlus,Y:\Programs\ShowKeyPlus\ShowKeyPlus.exe
  LINK %Programs%\Passwords & Keys\NT Password Edit,Y:\Programs\NTPWedit\ntpwedit64.exe
  LINK %Programs%\Passwords & Keys\Windows Login Unlocker,Y:\Programs\Windows Login Unlocker\WLU.exe

  // System Tools
  LINK %Programs%\System Tools\CPU-Z,Y:\Programs\CPU-Z\cpuz_x64.exe
  LINK %Programs%\System Tools\Change Keyboard Layout,Y:\Programs\Change Keyboard Layout\ChangeKeyboardLayout.cmd
  LINK %Programs%\System Tools\Command Prompt,%WinDir%\System32\cmd.exe
  LINK %Programs%\System Tools\Dependency Walker,Y:\Programs\Dependency Walker\depends.exe
  LINK %Programs%\System Tools\DotNet Version Detector,%SystemRoot%\Microsoft.NET\dotnet.exe
  LINK %Programs%\System Tools\RegShot,Y:\Programs\RegShot\Regshot64.exe
  LINK %Programs%\System Tools\Registry Backup,Y:\Programs\Registry Backup\TweakingRegistryBackup.exe
  LINK %Programs%\System Tools\Sysinternals Suite (Link),Y:\Programs\Sysinternals Suite
  LINK %Programs%\System Tools\WinNTSetup,Y:\Programs\WinNTSetup\WinNTSetup_x64.exe

  // Desktop
  //LINK %Desktop%\Control Panel,%WinDir%\System32\control.exe

  // Plain
  LINK %Programs%\7-Zip File Manager,Y:\Programs\7-Zip\7zFM.exe
  LINK %Programs%\CDBurnerXP,Y:\Programs\CDBurnerXP\cdbxpp.exe
  LINK %Programs%\HxD Hex Editor,X:\Program Files\HxD\HxD.exe
  LINK %Programs%\Internet Explorer,%ProgramFiles%\Internet Explorer\iexplore.exe
  LINK %Programs%\KeePassXC,X:\Program Files\KeePassXC\KeePassXC.exe
  LINK %Programs%\MPV,X:\Program Files\mpv\mpv.exe
  LINK %Programs%\Meld,X:\Program Files\Meld\Meld.exe
  LINK %Programs%\Mozilla Firefox,X:\Program Files\Mozilla Firefox\firefox.exe
  LINK %Programs%\Neovim (vim),X:\Program Files\Neovim\bin\nvim-qt.exe
  LINK %Programs%\PENetwork,%WinDir%\explorer.exe,Y:\Programs\PENetwork\PENetwork.exe,Y:\Programs\PENetwork\PENetwork.exe
  LINK %Programs%\PowerShell Core,Y:\Programs\PowerShell Core_x64\pwsh.exe
  LINK %Programs%\PowerShell,X:\Program Files\PowerShell-7-win-x64\pwsh.exe
  LINK %Programs%\Rufus,C:\rufus-3.21.exe
  LINK %Programs%\TreeSize Free,X:\Program Files\TreeSize Free\TreeSizeFree.exe

  // Network
  LINK %Programs%\Network\Disable Firewall,%WinDir%\System32\DisableFirewall.cmd,,%WinDir%\System32\shell32.dll#135
  LINK %Programs%\Network\Enable Firewall,%WinDir%\System32\EnableFirewall.cmd,,%WinDir%\System32\shell32.dll#135
  LINK %Programs%\Network\Initialize Network,%WinDir%\System32\InitializeNetwork.cmd,,%WinDir%\System32\shell32.dll#164

  EXEC @!%WinDir%\System32\PinUtil.exe Config %Windir%\System32\pecmd.ini
_END



_SUB InitPENetwork
  // Launch PENetwork
  EXEC Y:\Programs\PENetwork\PENetwork.exe

  // Remote Desktop Server Connect (Uncommented By RDC Plugin)
  // EXEC @!%WinDir%\System32\mstsc.exe /v:
_END



_SUB LoadShell
  // EXEC  = Wait, @background, ! Hide. ex: EXEC =WaitNoHide.cmd, EXEC @!=WaitHide.cmd, EXEC NoWaitNoHide.cmd, EXEC @!NoWaitHide.cmd

  // Hide start menu Startup folders
  EXEC @!%WinDir%\System32\attrib.exe +s +h "X:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup"
  EXEC @!%WinDir%\System32\attrib.exe +s +h "X:\Users\Default\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup"

  // Load drivers
  DEVI %WinDir%\inf\battery.inf
  // DEVI %WinDir%\inf\usbport.inf

  KILL explorer.exe
  SHEL %WinDir%\explorer.exe
  TEXT

  //EXEC @!%WinDir%\System32\mpg123.exe -q %SystemRoot%\Media\startup.mp3
  EXEC @!%WinDir%\System32\PinUtil.exe Config %Windir%\System32\Pecmd.ini

  // Show OSK TabletMode Button (Uncommented if "Show Touch Keyboard Button" enabled). Not to be changed, Replace //LINK by //=LINK
  // EXEC %WinDir%\System32\OskTray.exe
_END



_SUB FinalProcesses
  // Remove desktop.ini
  EXEC @!%WinDir%\System32\cmd.exe /c cd %SystemDrive%\Users && del /q /f /s /a desktop.ini

  REGI HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\ShowSuperHidden=#1
  REGI HKLM\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\ShowSuperHidden=#1

  // Do not hide file extensions!
  REGI HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\HideFileExt=#0
  // Hide Desktop Icons.
  REGI HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\HideIcons=#1
  // Minimiz Explorer Ribbon.
  REGI HKU\.DEFAULT\Software\Microsoft\Windows\CurrentVersion\Explorer\Ribbon\MinimizedStateTabletModeOff=#1
  // Use dark theme. Does not apply consistently, enjoy the brokeness.
  REGI HKU\.DEFAULT\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize\AppsUseLightTheme=#0
  REGI HKU\.DEFAULT\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize\SystemUsesLightTheme=#0

  // Just try to make the clock look familiar.
  REGI HKCU\Control Panel\International\sShortDate=dd.MM.yyyy
  REGI HKCU\Control Panel\International\sShortTime=HH:mm

  // Clean up start menu.
  REGI HKCU\Software\StartIsBack\Start_ShowMyDocs=#0
  REGI HKCU\Software\StartIsBack\Start_ShowMyPics=#0
  REGI HKCU\Software\StartIsBack\Start_ShowMyMusic=#0
  REGI HKCU\Software\StartIsBack\Start_ShowVideos=#0
  REGI HKCU\Software\StartIsBack\Start_ShowCommandPrompt=#0

  LOAD Y:\HBCD_PE.ini

  // EXEC @!%WinDir%\system32\xcopy.exe /EHY Y:\Programs >NUL\
_END



[PinUtil]
StartMenu1=%WinDir%\explorer.exe
//StartMenu2=%Desktop%\Mozilla Firefox.lnk
StartMenu2=X:\Program Files\Mozilla Firefox\firefox.exe
//StartMenu3=%WinDir%\regedit.exe
StartMenu4=%Programs%\PENetwork.lnk

TaskBar0=X:\Program Files\Mozilla Firefox\firefox.exe
TaskBar1=%WinDir%\System32\SnippingTool.exe
